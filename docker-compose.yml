version: '3'
services:
  server:
    build: .
    restart: unless-stopped
    env_file: .env
    depends_on:
      - redis
    command: python -m bot
    environment:
      JOB_TIMEOUT: 900
      REDIS_HOST: redis
  worker:
    build: .
    restart: unless-stopped
    env_file: .env
    depends_on:
      - redis
    command: rq worker -q -u redis://redis
    environment:
      JOB_TIMEOUT: 900
      LOG_DIR: /tmp/logs
    volumes:
      - ${PWD}/logs:/tmp/logs
  redis:
    image: redis:6
    restart: unless-stopped
    command: --appendonly yes --loglevel warning
    volumes:
      - ${PWD}/data:/data
